<div class="container-fluid">
  <!-- Profile Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card bg-primary text-white">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-2 text-center">
              <div class="profile-avatar mb-3">
                <% if (profile.avatar_url) { %>
                  <img src="<%= profile.avatar_url %>" alt="Profile" class="rounded-circle" width="100" height="100">
                <% } else { %>
                  <div class="bg-light rounded-circle d-flex align-items-center justify-content-center" 
                       style="width: 100px; height: 100px; margin: 0 auto;">
                    <i class="bi bi-person-fill text-primary" style="font-size: 3rem;"></i>
                  </div>
                <% } %>
              </div>
            </div>
            <div class="col-md-8">
              <h2 class="mb-2"><%= profile.first_name %> <%= profile.last_name %></h2>
              <p class="mb-1">
                <i class="bi bi-at me-2"></i><%= profile.username %>
              </p>
              <% if (fantasyTeam) { %>
                <p class="mb-1">
                  <i class="bi bi-trophy me-2"></i><%= fantasyTeam.team_name %>
                </p>
              <% } %>
              <% if (profile.favorite_team_name) { %>
                <p class="mb-1">
                  <i class="bi bi-heart me-2"></i>Favorite Team: <%= profile.favorite_team_name %>
                </p>
              <% } %>
              <p class="mb-0">
                <i class="bi bi-calendar me-2"></i>Member since <%= profile.member_since_display || new Date(profile.created_at).toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) %>
              </p>
            </div>
            <div class="col-md-2 text-center">
              <a href="/settings" class="btn btn-outline-light">
                <i class="bi bi-gear me-1"></i> Edit Profile
              </a>
            </div>
          </div>
          <% if (profile.bio) { %>
            <div class="row mt-3">
              <div class="col-12">
                <hr class="bg-white opacity-25">
                <p class="mb-0"><%= profile.bio %></p>
              </div>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Team Information -->
    <div class="col-md-4 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="bi bi-people-fill me-2"></i>Team Information
          </h5>
        </div>
        <div class="card-body">
          <% if (fantasyTeam) { %>
            <div class="text-center mb-3">
              <h4 class="text-primary"><%= fantasyTeam.team_name %></h4>
              <p class="text-muted mb-0">
                <i class="bi bi-person-badge me-1"></i>
                <%= fantasyTeam.roster_count || 0 %> players on roster
              </p>
            </div>
            <div class="d-grid gap-2">
              <a href="/teams/<%= fantasyTeam.team_id %>" class="btn btn-primary btn-sm">
                <i class="bi bi-eye me-1"></i> View Roster
              </a>
              <a href="/transactions" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-clock-history me-1"></i> Transaction History
              </a>
            </div>
          <% } else { %>
            <div class="text-center text-muted py-3">
              <i class="bi bi-exclamation-triangle fs-4"></i>
              <p class="mt-2 mb-0">No fantasy team found</p>
            </div>
          <% } %>
        </div>
      </div>
    </div>

    <!-- Achievements -->
    <div class="col-md-8 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="bi bi-trophy-fill me-2"></i>Achievements
          </h5>
        </div>
        <div class="card-body">
          <% if (achievements && achievements.length > 0) { %>
            <div class="row">
              <% achievements.forEach(achievement => { %>
                <div class="col-md-6 mb-3">
                  <div class="d-flex align-items-center">
                    <div class="me-3">
                      <% if (achievement.achievement_type === 'championship') { %>
                        <i class="bi bi-trophy-fill text-warning fs-4"></i>
                      <% } else if (achievement.achievement_type === 'high_score') { %>
                        <i class="bi bi-star-fill text-success fs-4"></i>
                      <% } else { %>
                        <i class="bi bi-award-fill text-info fs-4"></i>
                      <% } %>
                    </div>
                    <div>
                      <h6 class="mb-0"><%= achievement.achievement_type.replace('_', ' ').toUpperCase() %></h6>
                      <small class="text-muted">Season <%= achievement.season_year %></small>
                    </div>
                  </div>
                </div>
              <% }); %>
            </div>
          <% } else { %>
            <div class="text-center text-muted py-3">
              <i class="bi bi-trophy fs-4"></i>
              <p class="mt-2 mb-0">No achievements yet</p>
              <small>Keep playing to earn your first achievement!</small>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Recent Activity -->
    <div class="col-md-6 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="bi bi-clock-history me-2"></i>Recent Activity
          </h5>
        </div>
        <div class="card-body">
          <% if (recentActivity && recentActivity.length > 0) { %>
            <div class="timeline">
              <% recentActivity.slice(0, 5).forEach(activity => { %>
                <div class="timeline-item mb-3">
                  <div class="d-flex">
                    <div class="me-3">
                      <% if (activity.action_type.includes('trade')) { %>
                        <i class="bi bi-arrow-left-right text-info"></i>
                      <% } else if (activity.action_type.includes('waiver')) { %>
                        <i class="bi bi-clipboard-check text-success"></i>
                      <% } else if (activity.action_type.includes('draft')) { %>
                        <i class="bi bi-trophy text-warning"></i>
                      <% } else { %>
                        <i class="bi bi-info-circle text-muted"></i>
                      <% } %>
                    </div>
                    <div class="flex-grow-1">
                      <div class="fw-semibold small">
                        <%= activity.action_type.replace(/_/g, ' ').toUpperCase() %>
                      </div>
                      <div class="text-muted small">
                        <%= activity.details || 'Activity recorded' %>
                      </div>
                      <div class="text-muted" style="font-size: 0.75rem;">
                        <%= new Date(activity.created_at).toLocaleDateString() %>
                      </div>
                    </div>
                  </div>
                </div>
              <% }); %>
            </div>
            <% if (recentActivity.length > 5) { %>
              <div class="text-center">
                <a href="/transactions" class="btn btn-outline-primary btn-sm">
                  View All Activity
                </a>
              </div>
            <% } %>
          <% } else { %>
            <div class="text-center text-muted py-3">
              <i class="bi bi-clock fs-4"></i>
              <p class="mt-2 mb-0">No recent activity</p>
            </div>
          <% } %>
        </div>
      </div>
    </div>

    <!-- Trade History -->
    <div class="col-md-6 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="bi bi-arrow-left-right me-2"></i>Recent Trades
          </h5>
        </div>
        <div class="card-body">
          <% if (tradeHistory && tradeHistory.length > 0) { %>
            <% tradeHistory.forEach(trade => { %>
              <div class="trade-item mb-3 p-2 border rounded">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <div class="fw-semibold small">
                      Trade #<%= trade.trade_id %>
                    </div>
                    <div class="text-muted small">
                      Status: <span class="badge bg-success"><%= trade.status %></span>
                    </div>
                    <% if (trade.notes) { %>
                      <div class="text-muted small">
                        <%= trade.notes.substring(0, 50) %><%= trade.notes.length > 50 ? '...' : '' %>
                      </div>
                    <% } %>
                  </div>
                  <div class="text-muted small">
                    <%= trade.completion_date ? new Date(trade.completion_date).toLocaleDateString() : new Date(trade.proposal_date).toLocaleDateString() %>
                  </div>
                </div>
              </div>
            <% }); %>
            <div class="text-center">
              <a href="/transactions?type=trade" class="btn btn-outline-primary btn-sm">
                View All Trades
              </a>
            </div>
          <% } else { %>
            <div class="text-center text-muted py-3">
              <i class="bi bi-arrow-left-right fs-4"></i>
              <p class="mt-2 mb-0">No trades completed</p>
              <small>Trade with other managers to build your team!</small>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.timeline-item {
  position: relative;
  padding-left: 0;
}

.timeline-item:not(:last-child)::after {
  content: '';
  position: absolute;
  left: 8px;
  top: 25px;
  bottom: -15px;
  width: 1px;
  background: #dee2e6;
}

.profile-avatar img {
  object-fit: cover;
  border: 3px solid rgba(255, 255, 255, 0.2);
}

.trade-item {
  background-color: #f8f9fa;
  transition: background-color 0.2s;
}

.trade-item:hover {
  background-color: #e9ecef;
}
</style>